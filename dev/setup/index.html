<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Setup · PortMidi.jl</title><meta name="title" content="Setup · PortMidi.jl"/><meta property="og:title" content="Setup · PortMidi.jl"/><meta property="twitter:title" content="Setup · PortMidi.jl"/><meta name="description" content="Documentation for PortMidi.jl."/><meta property="og:description" content="Documentation for PortMidi.jl."/><meta property="twitter:description" content="Documentation for PortMidi.jl."/><meta property="og:url" content="https://JuliaMusic.github.io/PortMidi.jl/setup/"/><meta property="twitter:url" content="https://JuliaMusic.github.io/PortMidi.jl/setup/"/><link rel="canonical" href="https://JuliaMusic.github.io/PortMidi.jl/setup/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">PortMidi.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Setup</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Create-MIDI-output-channel"><span>Create MIDI output channel</span></a></li><li><a class="tocitem" href="#Cleanup"><span>Cleanup</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Setup</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Setup</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaMusic/PortMidi.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaMusic/PortMidi.jl/blob/main/docs/src/setup.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Setup-instructions-for-playing-music"><a class="docs-heading-anchor" href="#Setup-instructions-for-playing-music">Setup instructions for playing music</a><a id="Setup-instructions-for-playing-music-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-instructions-for-playing-music" title="Permalink"></a></h1><p>PortMidi can be used to play (virtual or electronic) musical instruments in real-time.  In the following, we briefly outline how to configure your computer for this case.</p><p>Here, we will use two standalone virutal instruments to get a uncomplicated setup.  The more powerful option is of course the use of a digitial audio workstation (DAW)  which can also recived and forward MIDI data to the instruments loaded within the DAW.</p><blockquote><p>The following text is a selection of options and clearly subject to personal opinion.  </p></blockquote><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>The easiest option is to install a <em>standalone</em> virtual instrument such as </p><ul><li><a href="https://www.decentsamples.com/product/decent-sampler-plugin/">Decent Sampler</a></li><li><a href="https://vital.audio/">Vital Synth</a></li><li><a href="https://surge-synthesizer.github.io/">Surge XT</a></li><li>(search the internet for your instrument of choice)</li></ul><p>If you want to try a DAW instead (which gives also access to virtual instruments without standalone mode). A DAW allows to record audio and MIDI, arrange MIDI tracks and load virtual instruments and audio effects.</p><p><em>One free open-source cross-platform option is <a href="https://lmms.io/">LMMS</a>. Another &#39;almost free&#39; option is <a href="https://www.reaper.fm/index.php">Reaper</a>, which has a pretty generous trail option (just a dialog bugging at the start-up, even after the expire of the trial phase). Obviously, many free and paid alternatives exist.</em></p><h2 id="Create-MIDI-output-channel"><a class="docs-heading-anchor" href="#Create-MIDI-output-channel">Create MIDI output channel</a><a id="Create-MIDI-output-channel-1"></a><a class="docs-heading-anchor-permalink" href="#Create-MIDI-output-channel" title="Permalink"></a></h2><p>First, we need to create a new MIDI output channel for sending MIDI messages from Julia to the virtual instrument. On Windows this requires an extra program, for the other platforms portmidi itself can create the channel.</p><h3 id="Linux-and-macOS"><a class="docs-heading-anchor" href="#Linux-and-macOS">Linux and macOS</a><a id="Linux-and-macOS-1"></a><a class="docs-heading-anchor-permalink" href="#Linux-and-macOS" title="Permalink"></a></h3><p>One linux and macOS one can use the <code>Pm_CreateVirtualOutput(name::String, interface::String, deviceinfo::Ptr)</code> function, see <a href="https://portmidi.github.io/portmidi_docs/group__grp__device.html#gad72a83e522ff11431c2ab1fc87508e9e">C docs</a> for the explaination. The third input should always be <code>C_NULL</code>. The output is either the error message or the new id.</p><blockquote><p>This part of the documentation is untested, please open an issue if the instructions no not work</p></blockquote><pre><code class="language-julia hljs">using PortMidi

Pm_Initialize()

# create virtual input
interface = Sys.islinux() ? &quot;ALSA&quot; : &quot;CoreMIDI&quot;
id_or_err = Pm_CreateVirtualOutput(&quot;Julia MIDI Out&quot;, interface, C_NULL) 

# check error
if Int(id_or_err) &lt; 0
    error(&quot;Could not open a virtual output device.\n\
           PortMidi error: &#39;&quot;, string(id_or_err), &quot;&#39;&quot;)
end

# obtain ID
id = Int(id_or_err)</code></pre><h3 id="Windows"><a class="docs-heading-anchor" href="#Windows">Windows</a><a id="Windows-1"></a><a class="docs-heading-anchor-permalink" href="#Windows" title="Permalink"></a></h3><p>The <code>Pm_CreateVirtualOutput</code> function is not implemented since the interface <code>MMSystem</code> does not provide a protable solution for this task. </p><h4 id="Creating-of-a-MIDI-channel-with-loopMIDI"><a class="docs-heading-anchor" href="#Creating-of-a-MIDI-channel-with-loopMIDI">Creating of a MIDI channel with loopMIDI</a><a id="Creating-of-a-MIDI-channel-with-loopMIDI-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-of-a-MIDI-channel-with-loopMIDI" title="Permalink"></a></h4><p>We can use the free program <a href="https://www.tobias-erichsen.de/software/loopmidi.html">loopMIDI</a> instead. </p><ul><li>Install <a href="https://www.tobias-erichsen.de/software/loopmidi.html">loopMIDI</a>. (Restart might be required.)</li><li>Create a new MIDI channel called <code>loopMIDI Port</code> and click the <code>+</code> button.</li></ul><h4 id="Finding-an-existing-MIDI-channel-with-PortMIDI"><a class="docs-heading-anchor" href="#Finding-an-existing-MIDI-channel-with-PortMIDI">Finding an existing MIDI channel with PortMIDI</a><a id="Finding-an-existing-MIDI-channel-with-PortMIDI-1"></a><a class="docs-heading-anchor-permalink" href="#Finding-an-existing-MIDI-channel-with-PortMIDI" title="Permalink"></a></h4><p>After the MIDI channel is created, we just need to obtain its ID.  <em>Important note: The first call of `Pm</em>Initialize()<code>needs to happen after the MIDI channel was created. Alternatively, one needs to call</code>Pm<em>Terminate()<code>first before</code>Pm</em>Initialize()` to obtain the correct list of current channels._</p><p>The following code uses the <code>Pm_GetDeviceInfo</code> function which returns a C pointer to a <code>PmDeviceInfo</code> which has inparticular a <code>name</code> and <code>output</code> field, which we check to get the right channel.</p><pre><code class="language-julia hljs">using PortMIDI

Pm_Initialize()

id = findfirst(x -&gt; unsafe_string(x.name) == &quot;loopMIDI Port&quot; &amp;&amp; x.output &gt; 0, (unsafe_load(Pm_GetDeviceInfo(i)) for i in 0:Pm_CountDevices()-1))

if isnothing(id)
    error(&quot;Could not find MIDI channel &#39;loopMIDI Port&#39;.&quot;)
end</code></pre><h3 id="Start-virtual-instrument-and-select-the-MIDI-channel-as-input"><a class="docs-heading-anchor" href="#Start-virtual-instrument-and-select-the-MIDI-channel-as-input">Start virtual instrument and select the MIDI channel as input</a><a id="Start-virtual-instrument-and-select-the-MIDI-channel-as-input-1"></a><a class="docs-heading-anchor-permalink" href="#Start-virtual-instrument-and-select-the-MIDI-channel-as-input" title="Permalink"></a></h3><p><em>With standalone instruments:</em> We now need to select the MIDI port <code>Julia MIDI Out</code> or <code>loopMIDI Port</code> in our virtual instrument. All programs have the <code>options</code> button in the top-left of the Window (Decent sampler/Surge XT: &#39;Options button&#39;, Vital: &#39;click the logo&#39;). One might need to configure the audio output as well, depending on the setup.</p><p><em>If using a DAW:</em> Select in the options the right MIDI input and configure the audio driver for your system. Afterward, load a virtual instrument and <em>arm</em> the track to listen to MIDI input.</p><h3 id="Open-output-channel-with-PortMidi"><a class="docs-heading-anchor" href="#Open-output-channel-with-PortMidi">Open output channel with PortMidi</a><a id="Open-output-channel-with-PortMidi-1"></a><a class="docs-heading-anchor-permalink" href="#Open-output-channel-with-PortMidi" title="Permalink"></a></h3><p>Once we have obtained the ID of a working MIDI output channel and setup the instruments, we can open the MIDI channel and send messages. Below is one small example:</p><p>Create a reference to a pointer for the MIDI stream.</p><pre><code class="language-julia hljs">stream = Ref{Ptr{PortMidi.PortMidiStream}}(C_NULL)
Pm_OpenOutput(stream, id, C_NULL, 0, C_NULL, C_NULL, 0)
# don&#39;t forget to call later: Pm_Close(stream[])</code></pre><p>MIDI note messages have to be compressed into 32 bits. We can use the <code>Pm_Message</code> function for this task, see C docs on <a href="https://portmidi.github.io/portmidi_docs/struct_pm_event.html">PmEvents</a> and <a href="https://portmidi.github.io/portmidi_docs/group__grp__events__filters.html#gaf1c22515214f7a2cbb1e1e8fb02602bd">Pm_Message</a> for more details.</p><p>Here, we just need to know that we need to provide a note on and note off messages. That is, </p><ul><li>a flag either <code>0x90</code> or <code>0x80</code> for note on/off events</li><li>the semitone of the note we want to play <code>C4 = 60</code></li><li>the velocity of the keystroke</li></ul><p>The following helper function allows us to play a note with a given duration.</p><pre><code class="language-julia hljs">Note_ON = 0x90
Note_OFF = 0x80
C4 = 60

function play_note(stream, note, velocity, duration)
    Pm_WriteShort(stream[], 0, Pm_Message(Note_ON, note, velocity))
    sleep(duration)
    Pm_WriteShort(stream[], 0, Pm_Message(Note_OFF, note, velocity))
end</code></pre><p>Finally, we can play some notes:</p><pre><code class="language-julia hljs">for i in 1:12
    @async play_note(stream, C4 + rand([-5,-2,0,2,5]), rand(80:120), 0.4 + 0.05*rand())
    sleep(0.5 + 0.05*rand())
end</code></pre><p>The <code>@async</code> helps us to meet the beat. However, for accurate timing one might need to use a different approach. (Ideas are welcome!)</p><p>If everything worked, you should head a small tune.</p><h2 id="Cleanup"><a class="docs-heading-anchor" href="#Cleanup">Cleanup</a><a id="Cleanup-1"></a><a class="docs-heading-anchor-permalink" href="#Cleanup" title="Permalink"></a></h2><p>Afterwards, we should close the MIDI stream and terminate PortMidi:</p><pre><code class="language-julia hljs">Pm_Close(stream[])
Pm_Terminate()</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Sunday 21 January 2024 08:45">Sunday 21 January 2024</span>. Using Julia version 1.10.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
